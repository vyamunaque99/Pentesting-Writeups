# 247CTF - My Magic Bytes

### Introducción
El desafio se presenta con la siguiente descripción

    Can you recover the secret XOR key we used to encrypt the flag?

Y se nos da un archivo para descargar que al descomprimirlo nos permite ebtener una imagen de nombre `my_magic_bytes.jpg.enc`. Sin embargo, no se puede visualiazar, Lo cual nos indica que la imagen se encuentra encriptada mediante una operacion `XOR` como lo dice la descripcion.
Dado el titulo del reto y el archivo provisto, se puede intuir que la clave es la firma del archivo .jpg, que tambien se conoce como `Magic Bytes`

### Preparacion de script
Mediante una busqueda encontramos las firmas que pueden pertenecen a un archivo`.jpg`

![](static/signatures.png)

La operacion base que se realizo para encriptar el archivo fue un `XOR` entre el archivo y la llave para obtener la imagen encriptada es posible revertirlo dada la naturaleza commutativa de la operacion. Asi que la llave se obtendra de una operacion entre la firma encriptada y las posibles firmas, de esta forma tendremos 3 llaves que tendremos que probar.

![](static/headers.png)

Definimos una lista para las posibles llaves y almacenamos el resultado de la operacion `XOR` entre la posible firma y la firma encriptada.

![](static/keys.png)

Ahora que tenemos las llaves tenemos que ir probando cada llave con la imagen encriptada, para ello definimos una funcion que aplique la operacion entre la llave y el archivo (Extraido de [OpenTechNotes](https://opentechnotes.blogspot.com/2014/08/xor-string-with-key-in-python.html))

![](static/xor_file.png)

Finalmente realizamos la operacion con cada llave y una de ellas debe de haberse descifrado correctamente al revisar los archivos

![](static/main.png)
![](static/files.png)